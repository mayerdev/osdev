<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –û–°</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="osdev.org –Ω–∞ —Ä—É—Å—Å–∫–æ–º">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/osdev/assets/css/0.styles.cf6cd58c.css" as="style"><link rel="preload" href="/osdev/assets/js/app.3c540b81.js" as="script"><link rel="preload" href="/osdev/assets/js/2.09df5680.js" as="script"><link rel="preload" href="/osdev/assets/js/12.f99e982a.js" as="script"><link rel="prefetch" href="/osdev/assets/js/10.f59a9f37.js"><link rel="prefetch" href="/osdev/assets/js/11.32aede7f.js"><link rel="prefetch" href="/osdev/assets/js/13.0e02a79c.js"><link rel="prefetch" href="/osdev/assets/js/14.e42164ce.js"><link rel="prefetch" href="/osdev/assets/js/15.2cc01d27.js"><link rel="prefetch" href="/osdev/assets/js/16.23958917.js"><link rel="prefetch" href="/osdev/assets/js/17.33e975cd.js"><link rel="prefetch" href="/osdev/assets/js/3.4032e2a1.js"><link rel="prefetch" href="/osdev/assets/js/4.09ee8a39.js"><link rel="prefetch" href="/osdev/assets/js/5.c661e667.js"><link rel="prefetch" href="/osdev/assets/js/6.aa86b854.js"><link rel="prefetch" href="/osdev/assets/js/7.2ffd272d.js"><link rel="prefetch" href="/osdev/assets/js/8.05215729.js"><link rel="prefetch" href="/osdev/assets/js/9.f7a7992e.js">
    <link rel="stylesheet" href="/osdev/assets/css/0.styles.cf6cd58c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/osdev/" class="home-link router-link-active"><!----> <span class="site-name">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –û–°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/osdev/intro/" class="nav-link router-link-active">
  –í–≤–µ–¥–µ–Ω–∏–µ
</a></div><div class="nav-item"><a href="/osdev/hardware/" class="nav-link">
  –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —á–∞—Å—Ç—å
</a></div><div class="nav-item"><a href="/osdev/os/" class="nav-link">
  –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –û–°
</a></div><div class="nav-item"><a href="/osdev/resources/" class="nav-link">
  –†–µ—Å—É—Ä—Å—ã
</a></div><div class="nav-item"><a href="/osdev/reference/" class="nav-link">
  –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
</a></div><div class="nav-item"><a href="/osdev/tools/" class="nav-link">
  –£—Ç–∏–ª–∏—Ç—ã
</a></div><div class="nav-item"><a href="https://wiki.osdev.org/Main_Page" target="_blank" rel="noopener noreferrer" class="nav-link external">
  –û—Ä–∏–≥–∏–Ω–∞–ª
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/mayerdev/osdev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/mayerdev/osdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/osdev/intro/" class="nav-link router-link-active">
  –í–≤–µ–¥–µ–Ω–∏–µ
</a></div><div class="nav-item"><a href="/osdev/hardware/" class="nav-link">
  –ê–ø–ø–∞—Ä–∞—Ç–Ω–∞—è —á–∞—Å—Ç—å
</a></div><div class="nav-item"><a href="/osdev/os/" class="nav-link">
  –ö–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –û–°
</a></div><div class="nav-item"><a href="/osdev/resources/" class="nav-link">
  –†–µ—Å—É—Ä—Å—ã
</a></div><div class="nav-item"><a href="/osdev/reference/" class="nav-link">
  –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
</a></div><div class="nav-item"><a href="/osdev/tools/" class="nav-link">
  –£—Ç–∏–ª–∏—Ç—ã
</a></div><div class="nav-item"><a href="https://wiki.osdev.org/Main_Page" target="_blank" rel="noopener noreferrer" class="nav-link external">
  –û—Ä–∏–≥–∏–Ω–∞–ª
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/mayerdev/osdev" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/mayerdev/osdev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>–í–≤–µ–¥–µ–Ω–∏–µ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/osdev/intro/" aria-current="page" class="sidebar-link">–ì–ª–∞–≤–Ω–∞—è</a></li><li><a href="/osdev/intro/required.html" class="sidebar-link">–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞–Ω–∏—è</a></li><li><a href="/osdev/intro/mistakes.html" class="sidebar-link">–û—à–∏–±–∫–∏ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö</a></li><li><a href="/osdev/intro/getting-started.html" class="sidebar-link">–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã</a></li><li><a href="/osdev/intro/kcl-linking.html" class="sidebar-link">–ö–∞–∫ —è–¥—Ä–æ, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ –∫–æ–¥ –Ω–∞ C —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ</a></li><li><a href="/osdev/intro/isr.html" aria-current="page" class="active sidebar-link">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/osdev/intro/isr.html#isr-interrupt-service-routine" class="sidebar-link">ISR - Interrupt Service Routine</a></li><li class="sidebar-sub-header"><a href="/osdev/intro/isr.html#–∫–æ–≥–¥–∞-–≤—ã–∑—ã–≤–∞—é—Ç—Å—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏" class="sidebar-link">–ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏</a></li><li class="sidebar-sub-header"><a href="/osdev/intro/isr.html#–ø—Ä–æ–±–ª–µ–º–∞" class="sidebar-link">–ü—Ä–æ–±–ª–µ–º–∞</a></li><li class="sidebar-sub-header"><a href="/osdev/intro/isr.html#—Ä–µ—à–µ–Ω–∏—è" class="sidebar-link">–†–µ—à–µ–Ω–∏—è</a></li></ul></li><li><a href="/osdev/intro/languages.html" class="sidebar-link">–Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</a></li><li><a href="/osdev/intro/uefi.html" class="sidebar-link">UEFI</a></li><li><a href="/osdev/intro/bios.html" class="sidebar-link">BIOS</a></li><li><a href="/osdev/intro/inline-asm.html" class="sidebar-link">–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏"><a href="#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏" class="header-anchor">#</a> –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π</h1> <h2 id="isr-interrupt-service-routine"><a href="#isr-interrupt-service-routine" class="header-anchor">#</a> ISR - Interrupt Service Routine</h2> <p>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ x86 - —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞, —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏. –í–Ω–µ—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤—ã–∑—ã–≤–∞—é—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (ISR).</p> <p>–¢–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω—ã –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º. –ü—Ä–∏–º–µ—Ä–æ–º –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞: –∫–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞–∂–∏–º–∞–µ—Ç–µ –∫–Ω–æ–ø–∫—É, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç IRQ1 (–ó–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ 1), –∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è. –¢–∞–π–º–µ—Ä—ã –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥–∏—Å–∫ —è–≤–ª—è—é—Ç—Å—è –¥—Ä—É–≥–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.</p> <p>–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º, –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∫–æ–¥–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ int; –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª—É–∂–±—ã MS-DOS, –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º, –∑–∞–ø—É—Å–∫–∞—é—â–∏–º INT 21h –∏ –ø–µ—Ä–µ–¥–∞—é—â–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞.</p> <p>–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –∑–Ω–∞–ª–∞, –∫–∞–∫—É—é –ø—Ä–æ—Ü–µ–¥—É—Ä—É –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, —Å–º–µ—â–µ–Ω–∏—è –¥–ª—è ISR —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Interrupt Descriptor Table, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ Protected Mode, –∏–ª–∏ Interrupt Vector Table, –∫–æ–≥–¥–∞ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ Real Mode.</p> <p>ISR –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º, –∏ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –≤—ã–∑–æ–≤–∞ ISR –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤—ã–∑–æ–≤–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—É–Ω–∫—Ü–∏–∏ C. –°–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ, ISR –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –∫–æ–¥–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏ iret (–∏–ª–∏ iretq –≤ Long Mode ‚Äî –¥–∞, –¥–∞–∂–µ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Intel), –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ C –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è ret –∏–ª–∏ retf. –û—á–µ–≤–∏–¥–Ω–æ–µ, –Ω–æ —Ç–µ–º –Ω–µ –º–µ–Ω–µ–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ–¥–Ω–æ–π –∏–∑ —Å–∞–º—ã—Ö &quot;–ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö&quot; —Ç—Ä–æ–π–Ω–æ–π –æ—à–∏–±–∫–∏ —Å—Ä–µ–¥–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–≤ –û–°.</p> <h2 id="–∫–æ–≥–¥–∞-–≤—ã–∑—ã–≤–∞—é—Ç—Å—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏"><a href="#–∫–æ–≥–¥–∞-–≤—ã–∑—ã–≤–∞—é—Ç—Å—è-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏" class="header-anchor">#</a> –ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏</h2> <h3 id="x86"><a href="#x86" class="header-anchor">#</a> x86</h3> <p>–ö–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø–æ–º–µ—â–∞–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–µ–∫ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:</p> <div class="language- extra-class"><pre class="language-text"><code>EFLAGS -&gt; CS -&gt; EIP
</code></pre></div><p>–ó–Ω–∞—á–µ–Ω–∏–µ CS –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–≤—É–º—è –±–∞–π—Ç–∞–º–∏, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –¥–≤–æ–π–Ω–æ–µ —Å–ª–æ–≤–æ.</p> <p>–ï—Å–ª–∏ —Ç–∏–ø —à–ª—é–∑–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ–º, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—á–∏—Å—Ç–∏—Ç —Ñ–ª–∞–≥ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è. –ï—Å–ª–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–æ–¥ –æ—à–∏–±–∫–∏ –≤ —Å—Ç–µ–∫ –≤ –≤–∏–¥–µ –¥–≤–æ–π–Ω–æ–≥–æ —Å–ª–æ–≤–∞.</p> <p>–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∑–∞–≥—Ä—É–∑–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ IDT –≤ CS.</p> <h3 id="x86-64"><a href="#x86-64" class="header-anchor">#</a> x86-64</h3> <p>–ö–æ–≥–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π, –æ–Ω –∏–∑–º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ RSP –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ IST, –∏ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç, —Å—Ç–µ–∫ –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º. –í –Ω–æ–≤—ã–π —Å—Ç–µ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –ø–æ–º–µ—â–∞–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:</p> <div class="language- extra-class"><pre class="language-text"><code>SS:RSP (original RSP) -&gt; RFLAGS -&gt; CS -&gt; RIP
</code></pre></div><p>CS –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ç—ã—Ä–µ—Ö—Å–ª–æ–≤–∏–µ.</p> <p>–ï—Å–ª–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–æ–ª—å—Ü–∞, SS —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 0, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω—É–ª–µ–≤–æ–π —Å–µ–ª–µ–∫—Ç–æ—Ä. –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏–∑–º–µ–Ω–∏—Ç —Ä–µ–≥–∏—Å—Ç—Ä RFLAGS, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –±–∏—Ç—ã TF, NT –∏ RF —Ä–∞–≤–Ω—ã–º–∏ 0. –ï—Å–ª–∏ —Ç–∏–ø –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—á–∏—Å—Ç–∏—Ç —Ñ–ª–∞–≥ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è.</p> <p>–ï—Å–ª–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º, –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç –∫–æ–¥ –æ—à–∏–±–∫–∏ –≤ —Å—Ç–µ–∫, –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –±–∞–π—Ç–∞–º–∏, —á—Ç–æ–±—ã —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ç—ã—Ä–µ—Ö—Å–ª–æ–≤–∏–µ.</p> <p>–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∑–∞–≥—Ä—É–∑–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ IDT –≤ CS –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ CS –¥–æ–ø—É—Å—Ç–∏–º—ã–º —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–º —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∫–æ–¥–∞.</p> <h2 id="–ø—Ä–æ–±–ª–µ–º–∞"><a href="#–ø—Ä–æ–±–ª–µ–º–∞" class="header-anchor">#</a> –ü—Ä–æ–±–ª–µ–º–∞</h2> <p>–ú–Ω–æ–≥–∏–µ –ª—é–¥–∏ –∏–∑–±–µ–≥–∞—é—Ç –∞—Å—Å–µ–º–±–ª–µ—Ä–∞ –∏ —Ö–æ—Ç—è—Ç —Å–¥–µ–ª–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –Ω–∞ —Å–≤–æ–µ–º –ª—é–±–∏–º–æ–º —è–∑—ã–∫–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è. GCC (–∞ —Ç–∞–∫–∂–µ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã) –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞—Å—Å–µ–º–±–ª–µ—Ä, –ø–æ—ç—Ç–æ–º—É –º–Ω–æ–≥–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –∏—Å–ø—ã—Ç—ã–≤–∞—é—Ç —Å–æ–±–ª–∞–∑–Ω –Ω–∞–ø–∏—Å–∞—Ç—å ISR, –ø–æ–¥–æ–±–Ω—ã–π —ç—Ç–æ–º—É:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* –ö–∞–∫ –ù–ï –ù–£–ñ–ù–û –ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π */</span>
<span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">&quot;pushad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ */</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">&quot;popad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä—ã */</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span><span class="token string">&quot;iret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">/* –£—Ä–∞! –£—Ä–∞! –¢—Ä–æ–π–Ω–∞—è –æ—à–∏–±–∫–∞ */</span>
    <span class="token comment">/* –î—É–º–∞–µ–º –æ —Å–≤–æ—ë–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>–≠—Ç–æ –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –û–Ω –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä—ã –∏ —Å—Ç–µ–∫ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ asm; –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –ø–æ–≤—Ä–µ–¥–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç–µ–∫–∞ –¥–æ –∏ –ø–æ—Å–ª–µ –≤–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏, —á—Ç–æ –≤–º–µ—Å—Ç–µ —Å iret –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫–æ–¥—É –∞—Å—Å–µ–º–±–ª–µ—Ä–∞, –ø–æ—Ö–æ–∂–µ–º—É –Ω–∞ —ç—Ç–æ—Ç:</p> <div class="language-nasm extra-class"><pre class="language-nasm"><code>push   <span class="token operator">%</span><span class="token register variable">ebp</span>
mov    <span class="token operator">%</span><span class="token register variable">esp</span>,<span class="token operator">%</span><span class="token register variable">ebp</span>
sub    <span class="token operator">$</span><span class="token operator">&lt;</span>—Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö<span class="token operator">&gt;</span>,<span class="token operator">%</span><span class="token register variable">esp</span>
pushad
# C –∫–æ–¥ –ø–∏—à–µ–º –∑–¥–µ—Å—å
popad
iret
# <span class="token string">'leave'</span> –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, <span class="token string">'pop %ebp'</span> –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤.
leave
ret
</code></pre></div><p>–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—á–µ–≤–∏–¥–Ω–æ, –∫–∞–∫ —ç—Ç–æ –ø–æ—Ä—Ç–∏—Ç —Å—Ç–µ–∫ (ebp –≤—ã—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã—Å–∫–∞–∫–∏–≤–∞–µ—Ç). –ù–µ –¥–µ–ª–∞–π —ç—Ç–æ–≥–æ.</p> <h2 id="—Ä–µ—à–µ–Ω–∏—è"><a href="#—Ä–µ—à–µ–Ω–∏—è" class="header-anchor">#</a> –†–µ—à–µ–Ω–∏—è</h2> <h3 id="—á–∏—Å—Ç—ã–∏-–∞—Å—Å–µ–º–±–ª–µ—Ä"><a href="#—á–∏—Å—Ç—ã–∏-–∞—Å—Å–µ–º–±–ª–µ—Ä" class="header-anchor">#</a> –ß–∏—Å—Ç—ã–π –ê—Å—Å–µ–º–±–ª–µ—Ä</h3> <p>–£–∑–Ω–∞–π—Ç–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–± –∞—Å—Å–µ–º–±–ª–µ—Ä–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –≤ –Ω—ë–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π üòÉ</p> <h3 id="–¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–∏-–≤—Ä–∞–ø–ø–µ—Ä-–∞—Å—Å–µ–º–±–ª–µ—Ä–∞"><a href="#–¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–∏-–≤—Ä–∞–ø–ø–µ—Ä-–∞—Å—Å–µ–º–±–ª–µ—Ä–∞" class="header-anchor">#</a> –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π –≤—Ä–∞–ø–ø–µ—Ä –∞—Å—Å–µ–º–±–ª–µ—Ä–∞</h3> <p>–ù–∞–ø–∏—à–∏—Ç–µ –æ–±–æ–ª–æ—á–∫—É –∞—Å—Å–µ–º–±–ª–µ—Ä–∞, –≤—ã–∑—ã–≤–∞—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é C –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏, –∏ —Ç–æ–ª—å–∫–æ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ iret.</p> <div class="language-nasm extra-class"><pre class="language-nasm"><code><span class="token operator">/</span><span class="token operator">*</span> –§–∞–π–ª: isr_wrapper.s <span class="token operator">*</span><span class="token operator">/</span>
.globl   isr_wrapper
.align   <span class="token number">4</span>
 
<span class="token label function">isr_wrapper:</span>
    pushad
    cld <span class="token operator">/</span><span class="token operator">*</span> –ö–æ–¥ C, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ sysV ABI, —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã DF –±—ã–ª –æ—á–∏—â–µ–Ω –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ <span class="token operator">*</span><span class="token operator">/</span>
    call interrupt_handler
    popad
    iret
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* –§–∞–π–ª: interrupt_handler.c */</span>
<span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="–¥–∏—Ä–µ–∫—Ç–∏–≤—ã-–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ-–¥–ª—è-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞"><a href="#–¥–∏—Ä–µ–∫—Ç–∏–≤—ã-–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ-–¥–ª—è-–∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞" class="header-anchor">#</a> –î–∏—Ä–µ–∫—Ç–∏–≤—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞</h3> <p>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤ –∏–º–µ—é—Ç –¥–∏—Ä–µ–∫—Ç–∏–≤—ã, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –æ–±—ä—è–≤–ª—è—Ç—å –æ–±—ã—á–Ω–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–ª–∞–≥–∞—è #pragma interrupt –∏–ª–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –º–∞–∫—Ä–æ—Å. Clang 3.9, Borland C, Watcom C/C++, Microsoft C 6.0 –∏ GCC –ø—Ä–µ–¥–ª–∞–≥–∞—é—Ç —ç—Ç–æ. Visual C++ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É, –ø–æ–∫–∞–∑–∞–Ω–Ω—É—é –≤ —Ä–∞–∑–¥–µ–ª–µ <strong>Naked-—Ñ—É–Ω–∫—Ü–∏–∏</strong>:</p> <h4 id="clang"><a href="#clang" class="header-anchor">#</a> Clang</h4> <p>–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 3.9, –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –¥–ª—è x86/x86-64.</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">interrupt_frame</span> <span class="token punctuation">{</span>
    <span class="token class-name">uword_t</span> ip<span class="token punctuation">;</span>
    <span class="token class-name">uword_t</span> cs<span class="token punctuation">;</span>
    <span class="token class-name">uword_t</span> flags<span class="token punctuation">;</span>
    <span class="token class-name">uword_t</span> sp<span class="token punctuation">;</span>
    <span class="token class-name">uword_t</span> ss<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token keyword">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>interrupt<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">interrupt_frame</span> <span class="token operator">*</span> frame<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="borland-c"><a href="#borland-c" class="header-anchor">#</a> Borland C</h4> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> interrupt <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="watcom-c-c"><a href="#watcom-c-c" class="header-anchor">#</a> Watcom C/C++</h4> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> _interrupt <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="naked-—Ñ—É–Ω–∫—Ü–∏–∏"><a href="#naked-—Ñ—É–Ω–∫—Ü–∏–∏" class="header-anchor">#</a> Naked-—Ñ—É–Ω–∫—Ü–∏–∏</h4> <p>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ–¥—É—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, –Ω–æ —Ç—Ä–µ–±—É—é—Ç, —á—Ç–æ–±—ã –≤—ã –≤—Ä—É—á–Ω—É—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å—Ç–µ–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞. –î–ª—è —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –±–µ–∑ —ç–ø–∏–ª–æ–≥–∞ –∏–ª–∏ –ø—Ä–æ–ª–æ–≥–∞. –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é <strong>naked</strong> ‚Äî —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ Visual C++ –ø—É—Ç–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–∞ <em>_declspec(naked)</em> –∫ —Ñ—É–Ω–∫—Ü–∏–∏. –í–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—ã –≤–∫–ª—é—á–∞–µ—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –≤–æ–∑–≤—Ä–∞—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, iretd), –ø–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ —á–∞—Å—Ç—å —ç–ø–∏–ª–æ–≥–∞, –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É —Ç–µ–ø–µ—Ä—å –±—ã–ª–æ –ø–æ—Ä—É—á–µ–Ω–æ –Ω–µ –≤–∫–ª—é—á–∞—Ç—å.</p> <p>–ï—Å–ª–∏ –≤—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –≤—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ—Ä–µ–π–º —Å—Ç–µ–∫–∞ —Ç–∞–∫, –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä; –æ–¥–Ω–∞–∫–æ, –ø–æ—Å–∫–æ–ª—å–∫—É ISR –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ä–µ–µ–Ω—Ç–µ—Ä–∞–±–µ–ª—å–Ω—ã–º–∏, –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.</p> <h4 id="microsoft-visual-c"><a href="#microsoft-visual-c" class="header-anchor">#</a> Microsoft Visual C++</h4> <p>Visual C++ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Ä–æ—Å –∞—Å—Å–µ–º–±–ª–µ—Ä–∞ __LOCAL_SIZE, –∫–æ—Ç–æ—Ä—ã–π —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤–∞—Å, —Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç–∞–º –≤ —Å—Ç–µ–∫–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏.</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">_declspec</span><span class="token punctuation">(</span>naked<span class="token punctuation">)</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _asm pushad<span class="token punctuation">;</span>
 
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
 
    _asm <span class="token punctuation">{</span>
        popad
        iretd
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="gcc-g"><a href="#gcc-g" class="header-anchor">#</a> GCC / G++</h4> <p>–í <a href="https://gcc.gnu.org/onlinedocs/gcc/x86-Function-Attributes.html#x86-Function-Attributes" target="_blank" rel="noopener noreferrer">–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ GCC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> –≥–æ–≤–æ—Ä–∏—Ç—Å—è, —á—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É—è –∞—Ç—Ä–∏–±—É—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π GCC, –æ–Ω–∏ –¥–æ–±–∞–≤–∏–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ C —Å –ø–æ–º–æ—â—å—é _<em>attribute</em>_((interrupt)). –¢–∞–∫ —á—Ç–æ –≤–º–µ—Å—Ç–æ:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* –ß–Å–†–ù–ê–Ø –ú–ê–ì–ò–Ø - –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è! */</span>
<span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">__asm__</span><span class="token punctuation">(</span><span class="token string">&quot;pushad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
    <span class="token function">__asm__</span><span class="token punctuation">(</span><span class="token string">&quot;popad; leave; iret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* –ß–Å–†–ù–ê–Ø –ú–ê–ì–ò–Ø! */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">interrupt_frame</span><span class="token punctuation">;</span>
 
<span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>interrupt<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">interrupt_frame</span><span class="token operator">*</span> frame<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>–í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è GCC –≥–æ–≤–æ—Ä–∏—Ç—Å—è, —á—Ç–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è iret –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–º–µ—Å—Ç–æ ret –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ö x86 –∏ x86-64. –í –Ω–µ–º —Ç–∞–∫–∂–µ –≥–æ–≤–æ—Ä–∏—Ç—Å—è: &quot;–ü–æ—Å–∫–æ–ª—å–∫—É GCC –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è SSE, MMX –∏ x87, –ø–∞—Ä–∞–º–µ—Ç—Ä GCC-mgeneral-regs-only –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.&quot;</p> <h5 id="—á–µ—Ä–Ω–∞—è-–º–∞–≥–∏—è"><a href="#—á–µ—Ä–Ω–∞—è-–º–∞–≥–∏—è" class="header-anchor">#</a> –ß—ë—Ä–Ω–∞—è –º–∞–≥–∏—è</h5> <p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω—ã–π –∫–æ–¥ –≤—ã—à–µ, –≥–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π exit-–∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ C –±—ã–ª –ø—Ä–æ–ø—É—â–µ–Ω, —á—Ç–æ –∏—Å–ø–æ—Ä—Ç–∏–ª–æ —Å—Ç–µ–∫. –¢–µ–ø–µ—Ä—å —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —ç—Ç–æ—Ç —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞, –≥–¥–µ –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é:</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/* –ß–Å–†–ù–ê–Ø –ú–ê–ì–ò–Ø - –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è! */</span>
<span class="token keyword">void</span> <span class="token function">interrupt_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">__asm__</span><span class="token punctuation">(</span><span class="token string">&quot;pushad&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* –î–µ–ª–∞–µ–º —á—Ç–æ-–Ω–∏–±—É–¥—å */</span>
    <span class="token function">__asm__</span><span class="token punctuation">(</span><span class="token string">&quot;popad; leave; iret&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* –ß–Å–†–ù–ê–Ø –ú–ê–ì–ò–Ø! */</span>
<span class="token punctuation">}</span>
</code></pre></div><p>–ê—Å—Å–µ–º–±–ª–µ—Ä–Ω—ã–π –∫–æ–¥ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:</p> <div class="language-nasm extra-class"><pre class="language-nasm"><code>push   <span class="token operator">%</span><span class="token register variable">ebp</span>
mov    <span class="token operator">%</span><span class="token register variable">esp</span>,<span class="token operator">%</span><span class="token register variable">ebp</span>
sub    <span class="token operator">$</span><span class="token operator">&lt;</span>—Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö<span class="token operator">&gt;</span>,<span class="token operator">%</span><span class="token register variable">esp</span>
pushad
# C<span class="token operator">-</span>–∫–æ–¥ –≥–¥–µ<span class="token operator">-</span>—Ç–æ –∑–¥–µ—Å—å
popad
leave
iret
leave # –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥
ret   # –º—ë—Ä—Ç–≤—ã–π –∫–æ–¥
</code></pre></div><p>–≠—Ç–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ leave —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫–æ–Ω—Ü–∞ —Ñ—É–Ω–∫—Ü–∏–∏ - –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ &quot;–≤—Ä—É—á–Ω—É—é&quot;, –∞ –æ–±—Ä–∞–±–æ—Ç–∫—É, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º, –æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ –∫–∞–∫ &quot;–º–µ—Ä—Ç–≤—ã–π –∫–æ–¥&quot;. –ò–∑–ª–∏—à–Ω–µ –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ —Ç–∞–∫–∏–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞ –æ–ø–∞—Å–Ω—ã. –≠—Ç–æ—Ç –∫–æ–¥ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–µ –∏–ª–∏ –¥–∞–∂–µ –Ω–∞ –¥—Ä—É–≥–æ–π –≤–µ—Ä—Å–∏–∏ —Ç–æ–≥–æ –∂–µ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞. –ü–æ—ç—Ç–æ–º—É –æ–Ω –Ω–∞—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏ —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã –∫–∞—Ä—Ç–∏–Ω—ã.</p> <h5 id="assembly-goto"><a href="#assembly-goto" class="header-anchor">#</a> Assembly Goto</h5> <p>–ù–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 4.5, GCC –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä &quot;asm goto&quot;. –û–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ISR –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ ISR.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/osdev/intro/kcl-linking.html" class="prev">
        –ö–∞–∫ —è–¥—Ä–æ, –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ –∫–æ–¥ –Ω–∞ C —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ
      </a></span> <span class="next"><a href="/osdev/intro/languages.html">
        –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
      </a>
      ‚Üí
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/osdev/assets/js/app.3c540b81.js" defer></script><script src="/osdev/assets/js/2.09df5680.js" defer></script><script src="/osdev/assets/js/12.f99e982a.js" defer></script>
  </body>
</html>
